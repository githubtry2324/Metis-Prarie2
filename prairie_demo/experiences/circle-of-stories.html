<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Li Serkl di Achimowin - The Circle of Stories</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #0a0a12;
            overflow: hidden;
            font-family: 'Georgia', serif;
        }
        #canvas-container {
            width: 100vw;
            height: 100vh;
        }
        .back-button {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(255, 215, 0, 0.9);
            color: #1a1a2e;
            border: 2px solid #FFD700;
            padding: 10px 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            font-weight: bold;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            font-family: 'Georgia', serif;
        }
        .back-button:hover {
            background: #FFD700;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
        }
        #info-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 320px;
            background: rgba(10, 10, 20, 0.9);
            border: 2px solid rgba(255, 215, 0, 0.4);
            border-radius: 12px;
            padding: 25px;
            color: #e0e0e0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        #info-panel h1 {
            color: #FFD700;
            font-size: 1.4rem;
            margin-bottom: 5px;
            text-shadow: 0 0 15px rgba(255, 215, 0, 0.4);
        }
        #info-panel h2 {
            color: #c0a040;
            font-size: 1rem;
            font-weight: normal;
            font-style: italic;
            margin-bottom: 15px;
            opacity: 0.9;
        }
        #info-panel p {
            font-size: 0.9rem;
            line-height: 1.7;
            margin-bottom: 12px;
            opacity: 0.9;
        }
        #selected-node {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 215, 0, 0.3);
            display: none;
        }
        #selected-node h3 {
            color: #FFD700;
            font-size: 1.1rem;
            margin-bottom: 8px;
        }
        #selected-node p {
            font-size: 0.85rem;
            line-height: 1.6;
        }
        #instruction {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(10, 10, 20, 0.85);
            border: 1px solid rgba(255, 215, 0, 0.3);
            border-radius: 25px;
            padding: 12px 30px;
            color: #c0a040;
            font-size: 0.9rem;
            z-index: 100;
        }
        #center-text {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            pointer-events: none;
            z-index: 50;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        #center-text.visible {
            opacity: 1;
        }
        #center-text h2 {
            color: #FFD700;
            font-size: 2rem;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
            margin-bottom: 10px;
        }
        #center-text p {
            color: #e0d0a0;
            font-size: 1.1rem;
            max-width: 500px;
            line-height: 1.6;
        }

        /* Credit footer */
        .experience-credit {
            position: fixed;
            bottom: 15px;
            right: 20px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            text-align: right;
            pointer-events: none;
            z-index: 100;
        }
        .experience-credit .designer {
            color: rgba(255, 215, 0, 0.6);
        }
    </style>
</head>
<body>
    <a href="../index.html" class="back-button">← Back to Prairie</a>

    <div id="info-panel">
        <h1>Li Serkl di Achimowin</h1>
        <h2>The Circle of Stories</h2>
        <p>
            In Métis tradition, all knowledge is connected like a great web.
            Stories carry the wisdom of our ancestors, linking the past to the present,
            and each teaching to every other.
        </p>
        <p>
            This circle shows how all aspects of Métis life—language, land, craft,
            and community—weave together into one living tradition.
            No teaching stands alone; each supports and enriches the others.
        </p>
        <div id="selected-node">
            <h3 id="node-title">Selected</h3>
            <p id="node-description">Description</p>
        </div>
    </div>

    <div id="instruction">Click on any glowing sphere to explore its connections</div>

    <div id="center-text">
        <h2>Wahkotowin</h2>
        <p>All things are related. The web of kinship connects every teaching, every story, every life.</p>
    </div>

    <div id="canvas-container"></div>

    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        // Scene setup
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a0a12);

        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 8, 20);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.maxDistance = 35;
        controls.minDistance = 8;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.3;

        // Lighting
        const ambientLight = new THREE.AmbientLight(0x333344, 0.5);
        scene.add(ambientLight);

        const centerLight = new THREE.PointLight(0xFFD700, 2, 30);
        centerLight.position.set(0, 0, 0);
        scene.add(centerLight);

        // Knowledge nodes - representing different aspects of Métis knowledge
        const knowledgeNodes = [
            {
                name: "Li Michif",
                subtitle: "Language",
                description: "The Michif language blends Cree verbs with French nouns, creating a unique tongue that carries the spirit of two worlds united. Every word holds generations of meaning.",
                color: 0x4488cc,
                connections: [1, 3, 7, 11]
            },
            {
                name: "La Tehr",
                subtitle: "The Land",
                description: "The prairie, rivers, and forests are not just resources—they are relatives. The land teaches patience, provides sustenance, and holds the bones of our ancestors.",
                color: 0x44aa44,
                connections: [0, 2, 4, 5, 8]
            },
            {
                name: "Li Perlaj",
                subtitle: "Beadwork",
                description: "The 'Flower Beadwork People' created intricate floral designs that carry mathematical precision. Each pattern tells a story of beauty and cultural pride.",
                color: 0xcc4488,
                connections: [1, 3, 6, 9]
            },
            {
                name: "Li Vyalon",
                subtitle: "The Fiddle",
                description: "Métis fiddle music makes feet move and hearts soar. The Red River Jig echoes through generations, bringing communities together in celebration.",
                color: 0xff6644,
                connections: [0, 2, 7, 10]
            },
            {
                name: "La Shaas",
                subtitle: "The Hunt",
                description: "The buffalo hunt was the heartbeat of Métis economy and identity. Its laws of cooperation and fairness became the foundation of Métis governance.",
                color: 0x8b5a2b,
                connections: [1, 5, 8, 10]
            },
            {
                name: "Li Michinn",
                subtitle: "Medicine",
                description: "Sage, sweetgrass, cedar, and tobacco—the four sacred medicines heal body, mind, heart, and spirit. This knowledge flows from the land through the hands of healers.",
                color: 0x88aa66,
                connections: [1, 4, 6, 9]
            },
            {
                name: "La Fami",
                subtitle: "Family",
                description: "Extended kinship networks define Métis community. 'Wahkotowin'—the understanding that all things are related—shapes how we treat each other and the world.",
                color: 0xffaa44,
                connections: [2, 5, 7, 11]
            },
            {
                name: "Li Konté",
                subtitle: "Stories",
                description: "Around winter fires, Elders share tales of Rougarou, Chi-Jean, and the ancestors. Stories carry law, history, and wisdom across generations.",
                color: 0xaa66cc,
                connections: [0, 3, 6, 10]
            },
            {
                name: "La Rivyaer",
                subtitle: "The River",
                description: "Rivers were highways of trade and connection. The river lot system shaped Métis settlements, ensuring every family had water, wood, and fertile soil.",
                color: 0x4488aa,
                connections: [1, 4, 9, 11]
            },
            {
                name: "La Sharette",
                subtitle: "The Cart",
                description: "The squeaking Red River Cart carried goods across the prairies. Its ingenious wooden design—no metal needed—made the Métis masters of trade.",
                color: 0x996633,
                connections: [2, 5, 8, 10]
            },
            {
                name: "La Saenchiir",
                subtitle: "The Sash",
                description: "The ceinture fléchée—arrow sash—is worn with pride. Its finger-woven patterns in red, blue, and gold mark Métis identity and craftsmanship.",
                color: 0xcc2244,
                connections: [3, 4, 7, 9]
            },
            {
                name: "Li Drwa",
                subtitle: "Rights",
                description: "From Louis Riel to today, the Métis have fought for recognition and rights. This struggle for justice continues, rooted in a proud history of resistance.",
                color: 0x6666cc,
                connections: [0, 6, 8, 10]
            }
        ];

        // Create nodes
        const nodeGroup = new THREE.Group();
        const nodeMeshes = [];
        const nodeLabels = [];
        const connectionLines = [];

        const radius = 10;

        knowledgeNodes.forEach((node, i) => {
            const angle = (i / knowledgeNodes.length) * Math.PI * 2;
            const x = Math.cos(angle) * radius;
            const z = Math.sin(angle) * radius;
            const y = Math.sin(angle * 2) * 1.5; // Gentle wave

            // Main sphere
            const sphereGeo = new THREE.SphereGeometry(0.8, 32, 32);
            const sphereMat = new THREE.MeshStandardMaterial({
                color: node.color,
                emissive: node.color,
                emissiveIntensity: 0.3,
                roughness: 0.3,
                metalness: 0.2
            });
            const sphere = new THREE.Mesh(sphereGeo, sphereMat);
            sphere.position.set(x, y, z);
            sphere.userData = { index: i, node: node };
            nodeGroup.add(sphere);
            nodeMeshes.push(sphere);

            // Outer glow
            const glowGeo = new THREE.SphereGeometry(1.1, 16, 16);
            const glowMat = new THREE.MeshBasicMaterial({
                color: node.color,
                transparent: true,
                opacity: 0.15,
                side: THREE.BackSide
            });
            const glow = new THREE.Mesh(glowGeo, glowMat);
            glow.position.copy(sphere.position);
            nodeGroup.add(glow);

            // Point light for each node
            const nodeLight = new THREE.PointLight(node.color, 0.5, 8);
            nodeLight.position.copy(sphere.position);
            nodeGroup.add(nodeLight);
        });

        scene.add(nodeGroup);

        // Create connection lines
        const lineMaterial = new THREE.LineBasicMaterial({
            color: 0xFFD700,
            transparent: true,
            opacity: 0.15
        });

        const drawnConnections = new Set();

        knowledgeNodes.forEach((node, i) => {
            node.connections.forEach(j => {
                const key = [Math.min(i, j), Math.max(i, j)].join('-');
                if (!drawnConnections.has(key)) {
                    drawnConnections.add(key);

                    const points = [];
                    const start = nodeMeshes[i].position;
                    const end = nodeMeshes[j].position;

                    // Create curved line through center
                    for (let t = 0; t <= 20; t++) {
                        const p = t / 20;
                        const x = start.x * (1 - p) + end.x * p;
                        const y = start.y * (1 - p) + end.y * p;
                        const z = start.z * (1 - p) + end.z * p;

                        // Curve toward center
                        const centerPull = Math.sin(p * Math.PI) * 0.3;
                        points.push(new THREE.Vector3(
                            x * (1 - centerPull),
                            y + Math.sin(p * Math.PI) * 2,
                            z * (1 - centerPull)
                        ));
                    }

                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const line = new THREE.Line(geometry, lineMaterial.clone());
                    line.userData = { from: i, to: j };
                    connectionLines.push(line);
                    scene.add(line);
                }
            });
        });

        // Center piece - representing unity
        const centerGeo = new THREE.IcosahedronGeometry(1.5, 2);
        const centerMat = new THREE.MeshStandardMaterial({
            color: 0xFFD700,
            emissive: 0xFFD700,
            emissiveIntensity: 0.4,
            roughness: 0.2,
            metalness: 0.5
        });
        const centerPiece = new THREE.Mesh(centerGeo, centerMat);
        scene.add(centerPiece);

        // Center glow
        const centerGlowGeo = new THREE.SphereGeometry(2.5, 32, 32);
        const centerGlowMat = new THREE.MeshBasicMaterial({
            color: 0xFFD700,
            transparent: true,
            opacity: 0.1,
            side: THREE.BackSide
        });
        const centerGlow = new THREE.Mesh(centerGlowGeo, centerGlowMat);
        scene.add(centerGlow);

        // Particle system - floating wisdom particles
        const particleCount = 500;
        const particleGeometry = new THREE.BufferGeometry();
        const particlePositions = new Float32Array(particleCount * 3);
        const particleSizes = new Float32Array(particleCount);

        for (let i = 0; i < particleCount; i++) {
            const angle = Math.random() * Math.PI * 2;
            const r = 3 + Math.random() * 12;
            particlePositions[i * 3] = Math.cos(angle) * r;
            particlePositions[i * 3 + 1] = (Math.random() - 0.5) * 8;
            particlePositions[i * 3 + 2] = Math.sin(angle) * r;
            particleSizes[i] = Math.random() * 0.05 + 0.02;
        }

        particleGeometry.setAttribute('position', new THREE.BufferAttribute(particlePositions, 3));
        particleGeometry.setAttribute('size', new THREE.BufferAttribute(particleSizes, 1));

        const particleMaterial = new THREE.PointsMaterial({
            color: 0xFFD700,
            size: 0.08,
            transparent: true,
            opacity: 0.6,
            blending: THREE.AdditiveBlending
        });

        const particles = new THREE.Points(particleGeometry, particleMaterial);
        scene.add(particles);

        // Raycaster for interaction
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        let selectedNode = null;

        const selectedNodeDiv = document.getElementById('selected-node');
        const nodeTitle = document.getElementById('node-title');
        const nodeDescription = document.getElementById('node-description');
        const centerText = document.getElementById('center-text');

        function onMouseClick(event) {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(nodeMeshes);

            if (intersects.length > 0) {
                const clicked = intersects[0].object;
                const node = clicked.userData.node;
                const index = clicked.userData.index;

                // Reset previous selection
                if (selectedNode !== null) {
                    nodeMeshes[selectedNode].material.emissiveIntensity = 0.3;
                    nodeMeshes[selectedNode].scale.setScalar(1);
                }

                // Highlight new selection
                selectedNode = index;
                clicked.material.emissiveIntensity = 0.8;
                clicked.scale.setScalar(1.3);

                // Update info panel
                nodeTitle.textContent = `${node.name} — ${node.subtitle}`;
                nodeDescription.textContent = node.description;
                selectedNodeDiv.style.display = 'block';
                centerText.classList.remove('visible');

                // Highlight connections
                connectionLines.forEach(line => {
                    if (line.userData.from === index || line.userData.to === index) {
                        line.material.opacity = 0.6;
                        line.material.color.setHex(node.color);
                    } else {
                        line.material.opacity = 0.1;
                        line.material.color.setHex(0xFFD700);
                    }
                });

                // Highlight connected nodes
                nodeMeshes.forEach((mesh, i) => {
                    if (i !== index) {
                        if (node.connections.includes(i)) {
                            mesh.material.emissiveIntensity = 0.5;
                        } else {
                            mesh.material.emissiveIntensity = 0.15;
                        }
                    }
                });

                controls.autoRotate = false;
            } else {
                // Check if clicked on center
                const centerIntersects = raycaster.intersectObject(centerPiece);
                if (centerIntersects.length > 0) {
                    // Reset all
                    if (selectedNode !== null) {
                        nodeMeshes[selectedNode].material.emissiveIntensity = 0.3;
                        nodeMeshes[selectedNode].scale.setScalar(1);
                        selectedNode = null;
                    }

                    connectionLines.forEach(line => {
                        line.material.opacity = 0.15;
                        line.material.color.setHex(0xFFD700);
                    });

                    nodeMeshes.forEach(mesh => {
                        mesh.material.emissiveIntensity = 0.3;
                    });

                    selectedNodeDiv.style.display = 'none';
                    centerText.classList.add('visible');
                    setTimeout(() => centerText.classList.remove('visible'), 4000);

                    controls.autoRotate = true;
                }
            }
        }

        window.addEventListener('click', onMouseClick);

        // Animation
        function animate() {
            requestAnimationFrame(animate);

            const time = performance.now() * 0.001;

            // Rotate center piece
            centerPiece.rotation.x = time * 0.2;
            centerPiece.rotation.y = time * 0.3;

            // Pulse center light
            centerLight.intensity = 2 + Math.sin(time * 2) * 0.5;
            centerGlowMat.opacity = 0.1 + Math.sin(time * 2) * 0.03;

            // Animate nodes (gentle bob)
            nodeMeshes.forEach((mesh, i) => {
                const baseY = Math.sin((i / knowledgeNodes.length) * Math.PI * 4) * 1.5;
                mesh.position.y = baseY + Math.sin(time + i) * 0.2;
            });

            // Rotate particles slowly
            particles.rotation.y = time * 0.05;

            // Update particle positions (drift)
            const positions = particleGeometry.attributes.position.array;
            for (let i = 0; i < particleCount; i++) {
                positions[i * 3 + 1] += Math.sin(time + i) * 0.002;
            }
            particleGeometry.attributes.position.needsUpdate = true;

            controls.update();
            renderer.render(scene, camera);
        }

        // Handle resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        animate();
    </script>

    <div class="experience-credit">
        Designed by <span class="designer">Amarah Ishaque</span><br>
        EDU596 Métis Foundational Knowledge
    </div>
</body>
</html>
