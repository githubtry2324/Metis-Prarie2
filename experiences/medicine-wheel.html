<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sacred Medicines - Métis Plant Knowledge</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;500;600&family=Montserrat:wght@300;400;600&display=swap');

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            overflow: hidden;
            background: linear-gradient(135deg, #0a1a0a 0%, #1a2f1a 50%, #0f1f0f 100%);
            font-family: 'Montserrat', sans-serif;
            color: white;
        }

        #canvas-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }

        /* Back Button */
        #back-btn {
            position: fixed;
            top: 25px;
            left: 25px;
            padding: 12px 22px;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 30px;
            color: white;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 100;
            font-family: 'Montserrat', sans-serif;
            letter-spacing: 0.5px;
        }
        #back-btn:hover {
            background: rgba(60, 100, 60, 0.5);
            border-color: rgba(100, 180, 100, 0.4);
            transform: translateX(-3px);
        }
        #back-btn svg { width: 14px; height: 14px; }

        /* Header */
        #header {
            position: fixed;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }
        #header h1 {
            font-family: 'Cormorant Garamond', serif;
            font-size: 2.2rem;
            font-weight: 300;
            letter-spacing: 6px;
            text-transform: uppercase;
            color: #a8d4a8;
            text-shadow: 0 0 30px rgba(100, 180, 100, 0.5);
            margin-bottom: 5px;
        }
        #header h2 {
            font-size: 0.75rem;
            font-weight: 300;
            letter-spacing: 3px;
            opacity: 0.6;
            text-transform: uppercase;
        }

        /* Info Panel */
        #info-panel {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 600px;
            background: rgba(10, 30, 10, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(100, 180, 100, 0.2);
            border-radius: 20px;
            padding: 30px 35px;
            z-index: 10;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5), 0 0 40px rgba(100, 180, 100, 0.1);
        }

        #plant-name {
            font-family: 'Cormorant Garamond', serif;
            font-size: 1.8rem;
            font-weight: 500;
            color: #b8e4b8;
            margin-bottom: 5px;
        }

        #plant-michif {
            font-size: 0.9rem;
            color: #88aa88;
            font-style: italic;
            margin-bottom: 15px;
            letter-spacing: 1px;
        }

        #plant-description {
            font-size: 0.95rem;
            line-height: 1.8;
            color: #d0e8d0;
            font-weight: 300;
        }

        #plant-uses {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(100, 180, 100, 0.2);
        }

        #plant-uses h4 {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #88aa88;
            margin-bottom: 10px;
        }

        .use-tag {
            display: inline-block;
            padding: 6px 14px;
            background: rgba(100, 180, 100, 0.15);
            border: 1px solid rgba(100, 180, 100, 0.3);
            border-radius: 20px;
            font-size: 0.8rem;
            margin: 4px;
            color: #a8d4a8;
        }

        /* Plant Navigation */
        #plant-nav {
            position: fixed;
            right: 30px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 10;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .plant-dot {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .plant-dot:hover {
            border-color: rgba(255, 255, 255, 0.8);
            transform: scale(1.2);
        }

        .plant-dot.active {
            background: #a8d4a8;
            border-color: #a8d4a8;
            box-shadow: 0 0 15px rgba(100, 180, 100, 0.6);
        }

        .plant-dot::after {
            content: attr(data-name);
            position: absolute;
            right: 25px;
            top: 50%;
            transform: translateY(-50%);
            white-space: nowrap;
            font-size: 0.75rem;
            opacity: 0;
            transition: opacity 0.3s;
            color: #a8d4a8;
            pointer-events: none;
        }

        .plant-dot:hover::after {
            opacity: 1;
        }

        /* Instruction */
        #instruction {
            position: fixed;
            bottom: 180px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.8rem;
            opacity: 0.5;
            letter-spacing: 2px;
            text-transform: uppercase;
            z-index: 10;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.6; }
        }

        /* Floating particles effect */
        .particle {
            position: fixed;
            width: 4px;
            height: 4px;
            background: rgba(150, 200, 150, 0.4);
            border-radius: 50%;
            pointer-events: none;
            animation: float 8s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(100vh) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
        }

        /* Credit footer */
        .experience-credit {
            position: fixed;
            bottom: 15px;
            right: 20px;
            font-size: 0.7rem;
            color: rgba(255, 255, 255, 0.4);
            text-align: right;
            pointer-events: none;
            z-index: 100;
        }
        .experience-credit .designer {
            color: rgba(255, 215, 0, 0.6);
        }
    </style>
</head>
<body>

<button id="back-btn" onclick="window.location.href='../index.html'">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="M19 12H5M12 19l-7-7 7-7"/>
    </svg>
    Back to Prairie
</button>

<div id="header">
    <h1>Sacred Medicines</h1>
    <h2>Li Mèdsin - Traditional Plant Knowledge</h2>
</div>

<div id="instruction">Drag to rotate • Click plant dots to explore</div>

<div id="plant-nav"></div>

<div id="info-panel">
    <div id="plant-name">Sage</div>
    <div id="plant-michif">La Sauge Sacrée</div>
    <div id="plant-description">
        Sage has been used by the Métis people for centuries as a sacred cleansing herb.
        When burned, its smoke purifies spaces and people, clearing negative energy and
        preparing for prayer or ceremony.
    </div>
    <div id="plant-uses">
        <h4>Traditional Uses</h4>
        <span class="use-tag">Smudging</span>
        <span class="use-tag">Purification</span>
        <span class="use-tag">Ceremony</span>
        <span class="use-tag">Healing</span>
    </div>
</div>

<div id="canvas-container"></div>

<!-- Floating particles -->
<script>
    for (let i = 0; i < 20; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
        particle.style.left = Math.random() * 100 + 'vw';
        particle.style.animationDelay = Math.random() * 8 + 's';
        particle.style.animationDuration = (6 + Math.random() * 4) + 's';
        document.body.appendChild(particle);
    }
</script>

<script type="importmap">
{
    "imports": {
        "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
        "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
    }
}
</script>

<script type="module">
import * as THREE from 'three';
import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

// Plant data - Sacred Métis medicines
const plants = [
    {
        name: "Sage",
        michif: "La Sauge Sacrée",
        description: "Sage has been used by the Métis people for centuries as a sacred cleansing herb. When burned, its smoke purifies spaces and people, clearing negative energy and preparing for prayer or ceremony.",
        uses: ["Smudging", "Purification", "Ceremony", "Healing"],
        color: 0x7a9a7a,
        secondaryColor: 0x556b55
    },
    {
        name: "Sweetgrass",
        michif: "Le Foin d'Odeur",
        description: "Known as the hair of Mother Earth, sweetgrass is braided and burned to attract positive energy and kind spirits. Its sweet vanilla-like scent brings peace and is used after sage to invite good things in.",
        uses: ["Blessing", "Prayer", "Attracting positivity", "Braiding"],
        color: 0xc4a84a,
        secondaryColor: 0x8a7530
    },
    {
        name: "Cedar",
        michif: "Le Cèdre",
        description: "Cedar is a powerful protector. Its branches are used in ceremony and medicine, offering protection during prayer. Cedar baths cleanse the body and spirit, and its tea strengthens the immune system.",
        uses: ["Protection", "Cleansing baths", "Tea medicine", "Ceremony"],
        color: 0x2d5a3d,
        secondaryColor: 0x1a3a25
    },
    {
        name: "Tobacco",
        michif: "Le Tabac",
        description: "Tobacco is the most sacred of all plants. It is never smoked casually but offered in prayer to the Creator and spirits. When asking for guidance or giving thanks, tobacco carries our prayers upward.",
        uses: ["Prayer offerings", "Gratitude", "Seeking guidance", "Sacred gift"],
        color: 0x6b4423,
        secondaryColor: 0x4a2f18
    },
    {
        name: "Wild Rose",
        michif: "La Rose Sauvage",
        description: "The wild rose, found across the prairies, produces rose hips rich in vitamin C. Métis grandmothers made tea and jam from the hips to keep families healthy through harsh winters.",
        uses: ["Vitamin C source", "Winter health", "Tea", "Jam making"],
        color: 0xd4618a,
        secondaryColor: 0xa84a6a
    },
    {
        name: "Yarrow",
        michif: "L'Herbe à Dindes",
        description: "Yarrow is a powerful healing plant used to stop bleeding and treat wounds. Métis hunters and travelers carried it for emergencies. Its tea also helps with fever and stomach troubles.",
        uses: ["Wound healing", "Stop bleeding", "Fever reducer", "Digestive aid"],
        color: 0xe8e8d8,
        secondaryColor: 0xc8c8b8
    }
];

let currentPlantIndex = 0;
let plantMeshes = [];
let scene, camera, renderer, controls;
let centerGroup;

// Initialize
function init() {
    // Scene
    scene = new THREE.Scene();
    scene.background = new THREE.Color(0x0a1a0a);
    scene.fog = new THREE.FogExp2(0x0a1a0a, 0.03);

    // Camera
    camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 100);
    camera.position.set(0, 2, 8);

    // Renderer
    renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.toneMapping = THREE.ACESFilmicToneMapping;
    renderer.toneMappingExposure = 1.2;
    document.getElementById('canvas-container').appendChild(renderer.domElement);

    // Controls
    controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.enablePan = false;
    controls.minDistance = 4;
    controls.maxDistance = 15;
    controls.maxPolarAngle = Math.PI / 2 + 0.3;
    controls.autoRotate = true;
    controls.autoRotateSpeed = 0.5;

    // Lighting
    setupLighting();

    // Create center group for plants
    centerGroup = new THREE.Group();
    scene.add(centerGroup);

    // Create ground
    createGround();

    // Create plants
    createPlants();

    // Create navigation dots
    createNavigation();

    // Update info panel
    updateInfoPanel(0);

    // Events
    window.addEventListener('resize', onResize);

    // Animate
    animate();
}

function setupLighting() {
    // Ambient
    const ambient = new THREE.AmbientLight(0x304030, 0.4);
    scene.add(ambient);

    // Main light (moonlight feel)
    const mainLight = new THREE.DirectionalLight(0xc0e0c0, 1.2);
    mainLight.position.set(5, 10, 5);
    mainLight.castShadow = true;
    mainLight.shadow.mapSize.width = 2048;
    mainLight.shadow.mapSize.height = 2048;
    mainLight.shadow.camera.near = 0.5;
    mainLight.shadow.camera.far = 50;
    mainLight.shadow.camera.left = -10;
    mainLight.shadow.camera.right = 10;
    mainLight.shadow.camera.top = 10;
    mainLight.shadow.camera.bottom = -10;
    scene.add(mainLight);

    // Rim light
    const rimLight = new THREE.DirectionalLight(0x80c080, 0.5);
    rimLight.position.set(-5, 3, -5);
    scene.add(rimLight);

    // Ground glow
    const groundLight = new THREE.PointLight(0x40a040, 2, 10);
    groundLight.position.set(0, 0.5, 0);
    scene.add(groundLight);
}

function createGround() {
    // Medicine wheel base
    const wheelGeo = new THREE.CylinderGeometry(3, 3, 0.1, 64);
    const wheelMat = new THREE.MeshStandardMaterial({
        color: 0x1a2a1a,
        roughness: 0.9,
        metalness: 0.1
    });
    const wheel = new THREE.Mesh(wheelGeo, wheelMat);
    wheel.position.y = -0.05;
    wheel.receiveShadow = true;
    scene.add(wheel);

    // Inner circles
    for (let i = 1; i <= 3; i++) {
        const ringGeo = new THREE.RingGeometry(i * 0.8 - 0.02, i * 0.8, 64);
        const ringMat = new THREE.MeshBasicMaterial({
            color: 0x3a5a3a,
            side: THREE.DoubleSide,
            transparent: true,
            opacity: 0.5
        });
        const ring = new THREE.Mesh(ringGeo, ringMat);
        ring.rotation.x = -Math.PI / 2;
        ring.position.y = 0.01;
        scene.add(ring);
    }

    // Cardinal direction markers
    const directions = [
        { angle: 0, color: 0xffffff },      // North - White
        { angle: Math.PI/2, color: 0xffcc00 },   // East - Yellow
        { angle: Math.PI, color: 0x222222 },     // South - Black
        { angle: 3*Math.PI/2, color: 0xcc3333 }  // West - Red
    ];

    directions.forEach(dir => {
        const markerGeo = new THREE.BoxGeometry(0.15, 0.05, 0.8);
        const markerMat = new THREE.MeshStandardMaterial({
            color: dir.color,
            emissive: dir.color,
            emissiveIntensity: 0.2
        });
        const marker = new THREE.Mesh(markerGeo, markerMat);
        marker.position.x = Math.sin(dir.angle) * 2.5;
        marker.position.z = Math.cos(dir.angle) * 2.5;
        marker.position.y = 0.03;
        marker.rotation.y = dir.angle;
        scene.add(marker);
    });
}

function createPlants() {
    plants.forEach((plant, index) => {
        const plantGroup = new THREE.Group();

        // Create stylized plant
        const stemCount = 5 + Math.floor(Math.random() * 4);

        for (let i = 0; i < stemCount; i++) {
            // Stem
            const stemHeight = 1.5 + Math.random() * 1;
            const stemCurve = new THREE.CatmullRomCurve3([
                new THREE.Vector3(0, 0, 0),
                new THREE.Vector3(
                    (Math.random() - 0.5) * 0.3,
                    stemHeight * 0.4,
                    (Math.random() - 0.5) * 0.3
                ),
                new THREE.Vector3(
                    (Math.random() - 0.5) * 0.5,
                    stemHeight * 0.7,
                    (Math.random() - 0.5) * 0.5
                ),
                new THREE.Vector3(
                    (Math.random() - 0.5) * 0.4,
                    stemHeight,
                    (Math.random() - 0.5) * 0.4
                )
            ]);

            const stemGeo = new THREE.TubeGeometry(stemCurve, 12, 0.03, 8, false);
            const stemMat = new THREE.MeshStandardMaterial({
                color: plant.secondaryColor,
                roughness: 0.8
            });
            const stem = new THREE.Mesh(stemGeo, stemMat);
            stem.castShadow = true;

            // Random position within the plant group
            stem.position.x = (Math.random() - 0.5) * 0.4;
            stem.position.z = (Math.random() - 0.5) * 0.4;

            plantGroup.add(stem);

            // Leaves/flowers at top
            const leafCount = 3 + Math.floor(Math.random() * 3);
            for (let j = 0; j < leafCount; j++) {
                const leafGeo = new THREE.SphereGeometry(0.08 + Math.random() * 0.08, 8, 6);
                leafGeo.scale(1, 0.6, 1);
                const leafMat = new THREE.MeshStandardMaterial({
                    color: plant.color,
                    roughness: 0.6,
                    emissive: plant.color,
                    emissiveIntensity: 0.1
                });
                const leaf = new THREE.Mesh(leafGeo, leafMat);

                const topPos = stemCurve.getPoint(0.8 + Math.random() * 0.2);
                leaf.position.copy(topPos);
                leaf.position.x += stem.position.x + (Math.random() - 0.5) * 0.2;
                leaf.position.z += stem.position.z + (Math.random() - 0.5) * 0.2;
                leaf.castShadow = true;

                plantGroup.add(leaf);
            }
        }

        // Position around center
        const angle = (index / plants.length) * Math.PI * 2;
        plantGroup.position.x = Math.sin(angle) * 1.8;
        plantGroup.position.z = Math.cos(angle) * 1.8;

        // Store reference
        plantGroup.userData = { index, plant };
        plantMeshes.push(plantGroup);

        centerGroup.add(plantGroup);
    });

    // Highlight first plant
    highlightPlant(0);
}

function highlightPlant(index) {
    plantMeshes.forEach((mesh, i) => {
        const scale = i === index ? 1.3 : 0.8;
        mesh.scale.setScalar(scale);

        // Update material emissive
        mesh.traverse(child => {
            if (child.isMesh && child.material.emissive) {
                child.material.emissiveIntensity = i === index ? 0.3 : 0.05;
            }
        });
    });
}

function createNavigation() {
    const nav = document.getElementById('plant-nav');

    plants.forEach((plant, index) => {
        const dot = document.createElement('div');
        dot.className = 'plant-dot' + (index === 0 ? ' active' : '');
        dot.setAttribute('data-name', plant.name);
        dot.addEventListener('click', () => selectPlant(index));
        nav.appendChild(dot);
    });
}

function selectPlant(index) {
    currentPlantIndex = index;

    // Update navigation dots
    document.querySelectorAll('.plant-dot').forEach((dot, i) => {
        dot.classList.toggle('active', i === index);
    });

    // Highlight plant
    highlightPlant(index);

    // Update info panel
    updateInfoPanel(index);

    // Rotate to face plant
    const angle = (index / plants.length) * Math.PI * 2;
    controls.autoRotate = false;

    // Animate camera
    const targetX = Math.sin(angle) * 6;
    const targetZ = Math.cos(angle) * 6;

    gsapTo(camera.position, { x: targetX, z: targetZ }, 1000);

    setTimeout(() => {
        controls.autoRotate = true;
    }, 2000);
}

// Simple animation helper
function gsapTo(obj, props, duration) {
    const start = { x: obj.x, y: obj.y, z: obj.z };
    const startTime = performance.now();

    function update() {
        const elapsed = performance.now() - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const eased = 1 - Math.pow(1 - progress, 3);

        if (props.x !== undefined) obj.x = start.x + (props.x - start.x) * eased;
        if (props.y !== undefined) obj.y = start.y + (props.y - start.y) * eased;
        if (props.z !== undefined) obj.z = start.z + (props.z - start.z) * eased;

        if (progress < 1) requestAnimationFrame(update);
    }

    requestAnimationFrame(update);
}

function updateInfoPanel(index) {
    const plant = plants[index];

    document.getElementById('plant-name').textContent = plant.name;
    document.getElementById('plant-michif').textContent = plant.michif;
    document.getElementById('plant-description').textContent = plant.description;

    const usesContainer = document.getElementById('plant-uses');
    usesContainer.innerHTML = '<h4>Traditional Uses</h4>';
    plant.uses.forEach(use => {
        const tag = document.createElement('span');
        tag.className = 'use-tag';
        tag.textContent = use;
        usesContainer.appendChild(tag);
    });
}

function onResize() {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
}

let time = 0;
function animate() {
    requestAnimationFrame(animate);
    time += 0.01;

    controls.update();

    // Gentle plant movement
    plantMeshes.forEach((plant, i) => {
        plant.rotation.y = Math.sin(time + i) * 0.05;
        plant.children.forEach((child, j) => {
            if (child.position.y > 0.5) {
                child.position.y += Math.sin(time * 2 + j) * 0.001;
            }
        });
    });

    renderer.render(scene, camera);
}

// Auto-cycle through plants
let autoCycleInterval;
function startAutoCycle() {
    autoCycleInterval = setInterval(() => {
        const nextIndex = (currentPlantIndex + 1) % plants.length;
        selectPlant(nextIndex);
    }, 8000);
}

// Start
init();
startAutoCycle();

// Pause auto-cycle on interaction
document.getElementById('plant-nav').addEventListener('click', () => {
    clearInterval(autoCycleInterval);
    setTimeout(startAutoCycle, 15000);
});
</script>

<div class="experience-credit">
    Designed by <span class="designer">Amarah Ishaque</span><br>
    EDU596 Métis Foundational Knowledge
</div>
</body>
</html>
